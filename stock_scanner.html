<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Stock Count Pro</title>
  <meta name="theme-color" content="#0c533e" />
  <link rel="manifest" href="./manifest.webmanifest">
  <link rel="icon" href="./icons/icon-192.png">
  <style>
    :root {
      /* === BRAND COLOURS (edit these 3 lines to rebrand) === */
      --brand:#0c533e; /* header, primary buttons */
      --brandText:#ffffff;
      --accent:#106f52; /* hovers, accents */
      /* ================================================ */
      --txt:#0b1f1a; --muted:#5b706b; --card:#ffffff; --line:#e9eceb; --bg:#f6f8f7;
      --good:#0a7a55; --warn:#915c18; --bad:#991b1b; --pill:#eef2ff; --pillText:#1e2a8a;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;background:var(--bg);color:var(--txt)}
    header{background:var(--brand);color:var(--brandText);padding:18px 16px;display:flex;align-items:center;gap:12px;position:sticky;top:0;z-index:5}
    header img{width:36px;height:36px;border-radius:6px}
    header h1{font-size:18px;margin:0}
    main{padding:16px;max-width:1100px;margin:0 auto}
    .grid{display:grid;gap:12px;grid-template-columns:repeat(auto-fit,minmax(280px,1fr))}
    .card{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:14px;box-shadow:0 1px 0 rgba(0,0,0,.03)}
    h2{font-size:16px;margin:0 0 10px 0}
    label{font-size:13px;color:var(--muted);display:flex;flex-direction:column;gap:6px}
    input,select,button{font-size:16px;padding:10px 12px;border-radius:10px;border:1px solid var(--line);background:#fff}
    button.primary{background:var(--brand);color:var(--brandText);border-color:var(--brand)}
    button.primary:hover{background:var(--accent)}
    button.ghost{background:transparent}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .spacer{flex:1}
    .muted{color:var(--muted);font-size:12px}
    #preview{width:100%;background:#000;border-radius:12px;aspect-ratio:3/2}
    table{width:100%;border-collapse:collapse;font-size:14px}
    th,td{border-bottom:1px solid var(--line);padding:10px;text-align:left}
    .pill{font-size:12px;background:var(--pill);color:var(--pillText);padding:2px 8px;border-radius:999px}
    .status-ok{color:var(--good)} .status-warn{color:var(--warn)} .status-bad{color:var(--bad)}
    .section{display:flex;flex-direction:column;gap:8px}
    .list{display:grid;gap:10px;grid-template-columns:repeat(auto-fit,minmax(240px,1fr))}
    .item{border:1px solid var(--line);border-radius:12px;padding:10px}
    .item .row{align-items:center}
    .small{font-size:12px}
    footer{padding:30px 16px;text-align:center;color:var(--muted)}
    .short{background:#fff5f5} /* shortage row highlight */
  </style>
</head>
<body>
  <header>
    <img src="./icons/icon-192.png" alt="logo"/>
    <h1>Stock Count Pro</h1>
    <div class="spacer"></div>
    <span class="muted" id="syncStatus">Offline (local)</span>
  </header>

  <main>
    <div class="grid">
      <div class="card section">
        <h2>Controls</h2>
        <div class="row">
          <label>Mode
            <select id="mode">
              <option value="count">COUNT</option>
              <option value="link">LINK BARCODE</option>
            </select>
          </label>
          <label>Area
            <select id="area">
              <option>FOH</option>
              <option>BOH</option>
            </select>
          </label>
          <label>User
            <input id="user" placeholder="Your name"/>
          </label>
          <div class="spacer"></div>
          <button id="exportLines">Export Counts CSV</button>
          <button id="exportXlsx" class="primary">Export Counts XLSX</button>
        </div>
        <div class="row">
          <label class="small">Items backend (optional)<br>
            <input id="itemsUrl" placeholder="Google Apps Script URL for items (GET/POST)"/>
          </label>
          <label class="small">Counts backend (optional)<br>
            <input id="countsUrl" placeholder="Google Apps Script URL for counts (POST)"/>
          </label>
          <button id="saveCfg">Save</button>
          <button id="syncNow" class="ghost">Sync Now</button>
        </div>
        <div class="muted small">Branding: change colours at the top of this file. Replace <code>icons/icon-192.png</code> with your logo.</div>
      </div>

      <div class="card section">
        <h2>Scanner</h2>
        <div class="row">
          <button id="start" class="primary">Start Scanner</button>
          <button id="stop" disabled>Stop</button>
          <button id="flip">Flip Camera</button>
          <div class="spacer"></div>
          <span class="muted" id="camInfo">—</span>
        </div>
        <video id="preview" playsinline></video>
        <div class="muted small">Allow camera access. If it stalls, tap Flip Camera.</div>
      </div>
    </div>

    <div class="grid">
      <div class="card section">
        <h2>Items</h2>
        <div class="row">
          <input id="search" placeholder="Search by SKU or name…" style="flex:1"/>
          <button id="addItem">Add Item</button>
          <button id="exportItems" class="ghost">Export Items CSV</button>
          <label class="small">Import CSV<input id="importItems" type="file" accept=".csv,text/csv"/></label>
        </div>
        <div id="itemList" class="list"></div>
      </div>

      <div class="card section" id="workPanel" style="display:none">
        <div class="row">
          <span id="modePill" class="pill">Mode</span>
          <strong id="selectedLabel"></strong>
          <div class="spacer"></div>
          <span id="panelStatus" class="muted"></span>
        </div>
        <div id="linkPanel" class="row" style="display:none">
          <button id="capture" class="primary">Capture barcode</button>
          <button id="clearBarcode" class="ghost">Clear barcode</button>
        </div>
        <div id="countPanel" class="row" style="display:none">
          <label>Qty
            <input id="qty" type="number" inputmode="numeric" min="0" step="1" placeholder="e.g. 12"/>
          </label>
          <label>Notes
            <input id="notes" placeholder="optional"/>
          </label>
          <button id="addLine" class="primary">Add</button>
        </div>
      </div>
    </div>

    <div class="grid">
      <div class="card section">
        <h2>Lines Logged</h2>
        <div class="row"><div class="spacer"></div><button id="clearLines" class="ghost">Clear</button></div>
        <table>
          <thead><tr><th>Time</th><th>Area</th><th>Barcode</th><th>SKU</th><th>Item</th><th>Qty</th><th>User</th><th>Notes</th><th></th></tr></thead>
          <tbody id="lines"></tbody>
        </table>
      </div>
      <div class="card section">
        <h2>Summary by SKU</h2>
        <table>
          <thead><tr><th>SKU</th><th>Item</th><th>Total</th><th>Par</th><th>Variance</th></tr></thead>
          <tbody id="summary"></tbody>
        </table>
        <div class="muted small">Shortages are highlighted. Par comes from your Items list.</div>
      </div>
    </div>
  </main>

  <footer>© Stock Count Pro — PWA</footer>

  <script src="https://unpkg.com/@zxing/library@latest"></script>
  <script src="https://cdn.jsdelivr.net/npm/exceljs@4.4.0/dist/exceljs.min.js"></script>
  <script src="./app.js"></script>
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => navigator.serviceWorker.register('./sw.js'));
    }
  </script>
</body>
</html>
